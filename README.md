# 🚀 Build Your Own Token Airdrop System and Frontend on the Kalp Blockchain

## Airdrop Vending Machine Challenge

---

## What is this challenge about?

This challenge involves developing a **token airdrop system** using the **Kalp blockchain** and building a **frontend application** to interact with it. You will:

- Create a **smart contract** in **Go** that manages the distribution of fungible tokens, allowing users to claim tokens through an airdrop mechanism.
- Develop a **frontend application** using **React** and **TypeScript** to provide a user interface that communicates with your smart contract via API endpoints generated by **Kalp Studio**.

This simulates real-world scenarios where tokens are distributed to users for promotional purposes or community engagement, and users interact with blockchain smart contracts seamlessly through a web interface.

## What will you learn?

**By participating in this challenge, you will:**

- Gain hands-on experience with the **Go** programming language.
- Understand the implementation of fungible tokens similar to **ERC-20** standards.
- Learn how to develop and deploy smart contracts on the **Kalp blockchain**.
- Enhance your skills in blockchain development and decentralized applications (**dApps**).
- Gain hands-on experience with **React** and **TypeScript**.
- Understand how to interact with blockchain smart contracts from a frontend application.
- Explore concepts such as token minting, balance management, token transfers, API integration, state management, and asynchronous operations in React.
- Improve your problem-solving and coding abilities in a practical environment.

---

## Ready to Get Started?

### Let's understand Token Airdrops and Connecting Frontend to Blockchain first!

Imagine a new café opens in town, and to attract customers, they hand out free coffee coupons to people passing by. These coupons can be redeemed for a free coffee, encouraging people to try their offerings. In the blockchain world, this concept translates to **token airdrops**.

A **token airdrop** is a method where blockchain projects distribute free tokens to users' wallets. It's a way to promote the project, incentivize early adopters, and build a community. Users can claim these tokens and later use them within the project's ecosystem or trade them on exchanges.

To allow users to interact with blockchain applications, we need a frontend interface. Connecting a frontend application to a blockchain involves interacting with smart contracts through API endpoints or blockchain nodes. This enables users to perform actions like claiming tokens, checking balances, or transferring assets directly from the web interface.

---

## Checkpoint 0: 📦 Installation

#### Before you begin, ensure you have the following:

- **Step 1: Install Go**

  - [Download Go](https://go.dev/doc/install) and install version `>=1.19` but `<1.20`.

- **Step 2: Install Node.js and npm**

  - [Download Node.js and npm](https://nodejs.org/en/download/)
  - Ensure you have **Node.js** version `>=14.x` and **npm** version `>=6.x`.

---

**To start the project, follow these steps:**

### Setting up the Smart Contract Project

1. **Clone the repository:**

   ```sh
   git clone https://github.com/Build-Hackathon/junior.git
   ```

2. **Navigate to the smart contract directory:**

   ```sh
   cd junior/airdrop-vending-machine/smart-contract
   ```

3. **Install the dependencies:**

   ```sh
   go mod tidy
   ```

After executing the above commands, your folder structure should look like this:

```
airdrop-vending-machine
├── smart-contract
│   ├── vendor
│   ├── go.mod
│   ├── go.sum
│   ├── main.go
│   └── krc.go  (Your Airdrop Vending Machine contract file)
```

### Setting up the Frontend Project

1. **Navigate to the frontend directory:**

   ```sh
   cd ../frontend
   ```

2. **Install the dependencies:**

   ```sh
   npm install
   ```

After executing the above commands, your folder structure should look like this:

```
airdrop-vending-machine
├── smart-contract
│   └── ...
├── frontend
    ├── src
    │   ├── app
    │   │   ├── favicon.ico
    │   │   ├── globals.css
    │   │   └── page.tsx
    │   ├── hooks
    │   │   └── useKalpApi.ts   (Your API hook)
    │   ├── pages
    ├── public
    ├── package.json
    ├── tsconfig.json
    └── README.md
```

---

## Checkpoint 1: 🏗 Smart Contract Development

### Smart Contract Walkthrough

Let's **open the file `krc.go`** located in the `smart-contract` folder and dive deep into the Airdrop Vending Machine smart contract.

#### 1. Initializing the Token Contract

The **`Initialize`** method sets up your token contract by assigning a name, symbol, and decimals to your fungible token. This method ensures that the token's metadata is properly configured before any transactions occur.

```go
func (s *SmartContract) Initialize(sdk kalpsdk.TransactionContextInterface, name string, symbol string, decimals string) (bool, error) {
    // Authorization check
    clientMSPID, err := sdk.GetClientIdentity().GetMSPID()
    if err != nil {
        return false, fmt.Errorf("failed to get MSPID: %v", err)
    }
    if clientMSPID != "mailabs" {
        return false, fmt.Errorf("client is not authorized to initialize contract")
    }

    // Ensure contract isn't already initialized
    bytes, err := sdk.GetState(nameKey)
    if err != nil {
        return false, fmt.Errorf("failed to get token name: %v", err)
    }
    if bytes != nil {
        return false, fmt.Errorf("contract options are already set")
    }

    // Set token details
    err = sdk.PutStateWithoutKYC(nameKey, []byte(name))
    if err != nil {
        return false, fmt.Errorf("failed to set token name: %v", err)
    }
    err = sdk.PutStateWithoutKYC(symbolKey, []byte(symbol))
    if err != nil {
        return false, fmt.Errorf("failed to set token symbol: %v", err)
    }
    err = sdk.PutStateWithoutKYC(decimalsKey, []byte(decimals))
    if err != nil {
        return false, fmt.Errorf("failed to set token decimals: %v", err)
    }

    return true, nil
}
```

- **Parameters:**

  - `name (string)`: The human-readable name of your token (e.g., "KalpToken").
  - `symbol (string)`: A short symbol representing your token (e.g., "KALP").
  - `decimals (string)`: The number of decimal places the token uses.

- **Return Values:**

  - `(bool, error)`: A boolean indicating success (`true`) or failure (`false`), and an error object if any issues arise.

#### 2. 🖨 Claiming Tokens (Minting)

The **`Claim`** method allows authorized accounts to mint new tokens and assign them to a specific address. This is the core function of the airdrop vending machine, distributing tokens to users who claim them.

```go
func (s *SmartContract) Claim(sdk kalpsdk.TransactionContextInterface, amount int, address string) error {
    // Authorization check
    clientMSPID, err := sdk.GetClientIdentity().GetMSPID()
    if err != nil {
        return fmt.Errorf("failed to get MSPID: %v", err)
    }
    if clientMSPID != "mailabs" {
        return fmt.Errorf("client is not authorized to mint new tokens")
    }

    // Ensure amount is positive
    if amount <= 0 {
        return fmt.Errorf("mint amount must be a positive integer")
    }

    // Update balance of the address
    currentBalanceBytes, err := sdk.GetState(address)
    if err != nil {
        return fmt.Errorf("failed to read account %s: %v", address, err)
    }
    var currentBalance int
    if currentBalanceBytes == nil {
        currentBalance = 0
    } else {
        currentBalance, _ = strconv.Atoi(string(currentBalanceBytes))
    }

    updatedBalance, err := add(currentBalance, amount)
    if err != nil {
        return err
    }
    err = sdk.PutStateWithoutKYC(address, []byte(strconv.Itoa(updatedBalance)))
    if err != nil {
        return err
    }

    // Update total supply
    totalSupplyBytes, err := sdk.GetState(totalSupplyKey)
    if err != nil {
        return fmt.Errorf("failed to retrieve total token supply: %v", err)
    }
    var totalSupply int
    if totalSupplyBytes == nil {
        totalSupply = 0
    } else {
        totalSupply, _ = strconv.Atoi(string(totalSupplyBytes))
    }
    totalSupply, err = add(totalSupply, amount)
    if err != nil {
        return err
    }
    err = sdk.PutStateWithoutKYC(totalSupplyKey, []byte(strconv.Itoa(totalSupply)))
    if err != nil {
        return err
    }

    // Emit Transfer event
    transferEvent := event{"0x0", address, amount}
    transferEventJSON, err := json.Marshal(transferEvent)
    if err != nil {
        return fmt.Errorf("failed to encode event: %v", err)
    }
    err = sdk.SetEvent("Transfer", transferEventJSON)
    if err != nil {
        return fmt.Errorf("failed to set event: %v", err)
    }

    log.Printf("Account %s balance updated to %d", address, updatedBalance)
    return nil
}
```

- **Parameters:**

  - `amount (int)`: The number of tokens to mint.
  - `address (string)`: The recipient's address where tokens will be credited.

- **Return Value:**

  - `error`: An error object if any issues occur; otherwise, `nil` on success.

#### 3. 📊 Checking Balances

##### a) `BalanceOf`

The **`BalanceOf`** method returns the token balance of a given account.

```go
func (s *SmartContract) BalanceOf(sdk kalpsdk.TransactionContextInterface, account string) (int, error) {
    balanceBytes, err := sdk.GetState(account)
    if err != nil {
        return 0, fmt.Errorf("failed to read account %s: %v", account, err)
    }
    if balanceBytes == nil {
        return 0, fmt.Errorf("account %s does not exist", account)
    }
    balance, _ := strconv.Atoi(string(balanceBytes))
    return balance, nil
}
```

- **Parameters:**

  - `account (string)`: The address of the account to query.

- **Return Values:**

  - `(int, error)`: The balance of the account, and an error object if any issues occur.

##### b) `TotalSupply`

The **`TotalSupply`** method returns the total number of tokens in circulation.

```go
func (s *SmartContract) TotalSupply(sdk kalpsdk.TransactionContextInterface) (int, error) {
    totalSupplyBytes, err := sdk.GetState(totalSupplyKey)
    if err != nil {
        return 0, fmt.Errorf("failed to retrieve total token supply: %v", err)
    }
    var totalSupply int
    if totalSupplyBytes == nil {
        totalSupply = 0
    } else {
        totalSupply, _ = strconv.Atoi(string(totalSupplyBytes))
    }
    log.Printf("TotalSupply: %d tokens", totalSupply)
    return totalSupply, nil
}
```

- **Return Values:**

  - `(int, error)`: The total supply of tokens, and an error object if any issues occur.

#### 4. 🔄 Transferring Tokens

The **`TransferFrom`** method allows a spender to transfer tokens from one account to another, given that they have sufficient allowance.

```go
func (s *SmartContract) TransferFrom(sdk kalpsdk.TransactionContextInterface, from string, to string, value int) error {
    // Authorization and allowance checks omitted for brevity

    // Initiate the transfer
    err := transferHelper(sdk, from, to, value)
    if err != nil {
        return fmt.Errorf("failed to transfer: %v", err)
    }

    // Update allowance and emit Transfer event
    // Implementation details omitted
    return nil
}
```

- **Parameters:**

  - `from (string)`: The sender's address.
  - `to (string)`: The recipient's address.
  - `value (int)`: The amount of tokens to transfer.

- **Return Value:**

  - `error`: An error object if any issues occur; otherwise, `nil` on success.

#### 5. 🏷 Reading Token Metadata

##### a) `Name`

Returns the name of the token.

```go
func (s *SmartContract) Name(sdk kalpsdk.TransactionContextInterface) (string, error) {
    bytes, err := sdk.GetState(nameKey)
    if err != nil {
        return "", fmt.Errorf("failed to get token name: %v", err)
    }
    return string(bytes), nil
}
```

- **Return Values:**

  - `(string, error)`: The token name, and an error object if any issues occur.

##### b) `Symbol`

Returns the symbol of the token.

```go
func (s *SmartContract) Symbol(sdk kalpsdk.TransactionContextInterface) (string, error) {
    bytes, err := sdk.GetState(symbolKey)
    if err != nil {
        return "", fmt.Errorf("failed to get token symbol: %v", err)
    }
    return string(bytes), nil
}
```

- **Return Values:**

  - `(string, error)`: The token symbol, and an error object if any issues occur.

---

## Checkpoint 2: 📀 Deploying the Smart Contract

Now it's time to deploy the smart contract.

### Steps:

1. **Sign Up and Log In to Kalp Studio Platform**

   - Follow the guide: [Sign Up and Log In to Kalp Studio Platform](https://doc.kalp.studio/Getting-started/Onboarding/How-to-Sign-Up-and-Log-In-to-Kalp-Studio-Platform/)

2. **Deploy Your Smart Contract**

   - Use the smart contract code provided.
   - Follow the guide: [Deploy a Smart Contract on Kalp Studio](https://doc.kalp.studio/Dev-documentation/Kalp-DLT/Smart-Contract-Write-Test-Deploy-Interact/Deploy-the-smart-contract/)

   **Steps:**

   - Access the Kalp Studio Dashboard.
   - Go to Kalp Instant Deployer.
   - Click on "Create New" Smart Contract.
   - Enter the details:
     - **Name:** Enter a name for your smart contract.
     - **Category:** Choose a category for your smart contract.
     - **Description:** Optionally, add a description for your smart contract.
   - **Upload your `smart-contract.zip` file.**

3. **Generate API Endpoints**

   - After deploying, Kalp Studio will provide you with API endpoints for each function of your smart contract.
   - **Example:**

     ![API Endpoint Example](images/api-endpoint-example.png)

4. **Generate Your API Key**

   - In Kalp Studio, navigate to the API key generation section.
   - Generate a new API key to authenticate your API requests.
   - **Example:**

     ![Generate API Key](images/generate-api-key.png)

---

## Checkpoint 3: 🕹️ Interacting with the Smart Contract

Now that we've deployed our token airdrop smart contract on the Kalp blockchain, it's time to interact with it.

### Steps:

1. **Initialize the Contract**
2. **Claim Tokens**
3. **Check Balance**
4. **Transfer Tokens**

We can use **Postman** for testing. Refer to the documentation for detailed instructions:

- [Interacting with Smart Contracts](https://doc.kalp.studio/Dev-documentation/Kalp-DLT/Smart-Contract-Write-Test-Deploy-Interact/Interacting-with-smart-contract/)

---

## Checkpoint 4: 🏗 Frontend Development

### Frontend Code Walkthrough

Let's **open the file `useKalpApi.ts`** located in the `frontend/src/hooks` folder and see how the frontend interacts with the Kalp blockchain.

#### 1. Setting Up the API Hook

The **`useKalpApi`** hook encapsulates all the API calls to your smart contract. It manages loading states, errors, and provides functions to interact with the contract.

```typescript
import { useState } from 'react';

export const useKalpApi = () => {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<any>(null);

  const apiKey = process.env.NEXT_PUBLIC_API_KEY;

  // ... rest of the code
};
```

- **State Management:**

  - `loading`: Indicates whether an API call is in progress.
  - `error`: Holds any error that occurs during API calls.

- **API Key:**

  - `apiKey`: Your Kalp Studio API key stored in environment variables for security.

#### 2. Making API Calls

The **`callApi`** function handles making HTTP requests to the Kalp blockchain API.

```typescript
const callApi = async (endpoint: string, args: { [key: string]: any }) => {
  setError(null);
  setLoading(true);

  const params = {
    network: 'TESTNET',
    blockchain: 'KALP',
    walletAddress: 'your-wallet-address',
    args: args,
  };

  try {
    const response = await fetch(endpoint, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-api-key': apiKey!,
      },
      body: JSON.stringify(params),
    });

    const data = await response.json();

    if (!response.ok) {
      throw new Error(data.message || 'Something went wrong');
    }

    setLoading(false);
    return data;
  } catch (err: any) {
    setError(err);
    setLoading(false);
    throw err;
  }
};
```

- **Parameters:**

  - `endpoint (string)`: The API endpoint URL.
  - `args (object)`: The arguments to pass to the smart contract function.

- **API Request:**

  - Sends a POST request with the required headers and body.
  - Handles the response and error states.

#### 3. Interacting with Smart Contract Functions

##### a) Claim Tokens

```typescript
const claim = async (address: string) => {
  const endpoint = 'https://your-api-endpoint/Claim';
  const args = {
    amount: 100,
    address: address,
  };
  return callApi(endpoint, args);
};
```

- **Purpose:** Allows a user to claim tokens by calling the `Claim` function of your smart contract.

##### b) Check Balance

```typescript
const balanceOf = async (account: string) => {
  const endpoint = 'https://your-api-endpoint/BalanceOf';
  const args = {
    account: account,
  };
  return callApi(endpoint, args);
};
```

- **Purpose:** Retrieves the token balance of a specific account.

##### c) Get Total Supply

```typescript
const totalSupply = async () => {
  const endpoint = 'https://your-api-endpoint/TotalSupply';
  const args = {};
  return callApi(endpoint, args);
};
```

- **Purpose:** Gets the total supply of tokens from your smart contract.

##### d) Transfer Tokens

You need to add the **Transfer** functionality to your frontend.

```typescript
const transferFrom = async (from: string, to: string, value: number) => {
  const endpoint = 'https://your-api-endpoint/TransferFrom';
  const args = {
    from: from,
    to: to,
    value: value,
  };
  return callApi(endpoint, args);
};
```

- **Purpose:** Allows a user to transfer tokens from one account to another by calling the `TransferFrom` function of your smart contract.

#### 4. Returning the API Functions

```typescript
return { claim, balanceOf, totalSupply, transferFrom, loading, error };
```

- **Exports:** The API functions and state variables for use in your components.

---

## Checkpoint 5: 🔧 Configuring the Frontend with Your API Endpoints

Now that you have your API endpoints and API key from the smart contract deployment, you need to replace the placeholder endpoints and configure your API key in the frontend code.

### Steps:

1. **Update Environment Variables**

   - **Create a `.env.local` file in your project root:**

     ```sh
     touch .env.local
     ```

   - **Add your API key to the `.env.local` file:**

     ```env
     NEXT_PUBLIC_API_KEY=your-kalp-api-key
     ```

   - **Note:** Prefixing the variable with `NEXT_PUBLIC_` makes it accessible in the browser.

2. **Replace API Endpoints in `useKalpApi.ts`**

   - Locate the endpoints in your code and replace them with your generated endpoints.

     ```typescript
     const claim = async (address: string) => {
       const endpoint = 'https://your-api-endpoint/Claim';
       const args = {
         amount: 100,
         address: address,
       };
       return callApi(endpoint, args);
     };

     const balanceOf = async (account: string) => {
       const endpoint = 'https://your-api-endpoint/BalanceOf';
       const args = {
         account: account,
       };
       return callApi(endpoint, args);
     };

     const totalSupply = async () => {
       const endpoint = 'https://your-api-endpoint/TotalSupply';
       const args = {};
       return callApi(endpoint, args);
     };

     const transferFrom = async (from: string, to: string, value: number) => {
       const endpoint = 'https://your-api-endpoint/TransferFrom';
       const args = {
         from: from,
         to: to,
         value: value,
       };
       return callApi(endpoint, args);
     };
     ```

   - **Replace** `'https://your-api-endpoint/FunctionName'` with the actual endpoints provided by Kalp Studio.

     - **For example:**

       ```typescript
       const claim = async (address: string) => {
         const endpoint = 'https://gateway-api.kalp.studio/v1/contract/kalp/invoke/YourContractID/Claim';
         const args = {
           amount: 100,
           address: address,
         };
         return callApi(endpoint, args);
       };
       ```

3. **Update the Wallet Address**

   - In the `callApi` function, update the `walletAddress` parameter:

     ```typescript
     const params = {
       network: 'TESTNET',
       blockchain: 'KALP',
       walletAddress: 'your-wallet-address',
       args: args,
     };
     ```

   - **Replace** `'your-wallet-address'` with the address you want to use for transactions.

---

## Checkpoint 6: ▶️ Running the Frontend Application

Now that you've configured your API endpoints and API key, you're ready to run the application.

### Steps:

1. **Start the Development Server:**

   ```sh
   npm run dev
   ```

2. **Open the Application in Your Browser:**

   - Navigate to `http://localhost:3000` in your web browser.

3. **Interact with the Application:**

   - Use the interface to claim tokens, check balances, transfer tokens, and view the total supply.
   - The application will communicate with your deployed smart contract via the configured API endpoints.

---

## Submission Guidelines

- **Functionality:**

  - Your submission should include both the **smart contract** and the **frontend application**.
  - The frontend must implement the **Transfer** functionality in addition to **Claim**, **BalanceOf**, and **TotalSupply**.
  - **We prefer submissions where the frontend is as good as you can make it.** A user-friendly and well-designed interface is highly appreciated.

- **Code Quality:**

  - Ensure your code is clean, well-documented, and follows best practices.
  - Include comments where necessary to explain complex logic.

- **Instructions:**

  - Update the README with any additional steps required to run your application.
  - Ensure all API endpoints are correctly configured and instructions are clear.

- **Deployment:**

  - deploy your frontend application and provide a live link.
  - Ensure your smart contract is deployed on the Kalp blockchain and accessible via the API endpoints.

- **Extra Features:**

  - Feel free to add any extra functionalities or improvements.
  - Additional features like transaction history etc will be considered a plus.

---

## Conclusion

Congratulations! You've successfully built a **token airdrop system** and a **frontend application** that interacts with your smart contract on the Kalp blockchain. By completing this challenge, you've learned how to:

- Develop and deploy a smart contract using **Go** on the **Kalp blockchain**.
- Generate API endpoints and API keys using **Kalp Studio**.
- Configure a **React** frontend to communicate with blockchain APIs.
- Manage state and handle asynchronous API calls in React.
- Securely store and use API keys in a frontend application.

For additional details and advanced configurations, refer to the [Kalp SDK documentation](https://docs.kalp.studio/).

---

**Feel free to explore further functionalities and enhance your smart contract and frontend application. Consider adding features like user authentication, transaction history, or integrating with wallets for a more comprehensive dApp experience. Good luck, and happy coding!**

---
